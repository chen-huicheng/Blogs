## 负载均衡

负载均衡是一种计算机网络技术，可以将计算机集群的资源进行合理分配，来避免单台服务器过载，提高系统的吞吐量、响应时间。依据四层的信息或七层的信息来决定怎么样转发流量，可分为四层或七层的负载均衡。这里的四层和七层指的是OSI七层模型中的第四层传输层和第七次应用层。



简述：一个HTTP请求的链路

1.   浏览器键入 URL 链接，回车
2.   解析域名 DNS，查询服务器的真实地址 IP
3.   将 HTTP 数据包交给可靠传输 TCP（应用层）
4.   TCP 添加协议头（保证可靠传输，流量控制，拥塞控制）交给 IP（传输层）
5.   IP 添加协议头（网络层）
6.   MAC 添加协议头 （网络链路层）
7.   到达服务器，逐层解析。

## 四层

**四层负载均衡是基于 IP + 端口的负载均衡**

主要通过报文中的目标地址和端口，再加上负载均衡设备设置的服务器选择方式，决定最终选择的内部服务器。





## 七层

**七层就基于 URL 等应用层信息的负载均衡**

所谓七层负载均衡，也称为“内容交换”，也就是主要通过报文中的真正有意义的应用层内容， 再加上负载均衡设备设置的服务器选择方式，决定最终选择的内部服务器。 

以常见的　TCP　为例，负载均衡设备如果要根据真正的应用层内容再选择服务器，

只能先代理最终的服务器和客户端建立连接（TCP 三次握手）后，才可能接收到客户端发送的真正应用层内容的报文， 然后再根据该报文中的特定字段，再加上负载均衡设备设置的服务器选择方式，决定最终选择的内部服务器。

负载均衡设备在这种情况下，更类似于一个代理服务器。负载均衡和前端的客户端以及后端的服务器会分别建立 TCP 连接。 所以从这个技术原理上来看，七层负载均衡明显地对负载均衡设备的要求更高，处理七层的能力也必然会低于四层模式的部署方式。  